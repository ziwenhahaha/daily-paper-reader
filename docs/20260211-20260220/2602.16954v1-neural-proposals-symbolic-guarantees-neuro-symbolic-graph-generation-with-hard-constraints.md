---
title: "Neural Proposals, Symbolic Guarantees: Neuro-Symbolic Graph Generation with Hard Constraints"
title_zh: 神经提议，符号保证：具有硬约束的神经符号图生成
authors: "Chuqin Geng, Li Zhang, Mark Zhang, Haolin Ye, Ziyu Zhao, Xujie Si"
date: 2026-02-18
pdf: "https://arxiv.org/pdf/2602.16954v1"
tags: ["query:sr"]
score: 8.0
evidence: 带有符号约束的分子生成神经符号框架
tldr: 针对纯深度学习在分子和图生成中缺乏可控性和形式化保证的问题，本文提出神经符号图生成模型（NSGGM）。该框架将分子生成视为支架与交互学习任务，结合自回归神经网络提议支架与高效SMT求解器执行硬性约束，确保生成的分子在化学和结构上完全合规。该方法在保持高性能的同时，提供了纯神经方法无法实现的显式可控性、可解释性与验证保障。
motivation: 传统的纯深度学习图生成方法属于黑盒模型，难以保证生成结果符合复杂的硬性化学约束和用户自定义规则。
method: 提出NSGGM框架，利用神经网络生成初始支架，并结合SMT求解器在生成过程中强制执行逻辑约束，实现“构建即正确”。
result: 在无约束和有约束的生成任务中均表现优异，并引入了逻辑约束分子基准测试以评估模型的严格规则遵循能力。
conclusion: 神经符号建模能够兼顾最先进的生成性能与显式的可控性及形式化保证，为受限图生成提供了新路径。
---

## 摘要
我们对用于分子和图生成的黑盒纯深度神经方法提出了挑战，这些方法在可控性方面存在局限，且缺乏形式化保证。我们引入了神经符号图生成建模（NSGGM），这是一个将分子生成重新定义为带有符号组装的支架与交互学习任务的神经符号框架。其中，自回归神经模型负责提议支架并细化交互信号，而高效的 CPU SMT 求解器在构建完整图的同时，强制执行化学有效性、结构规则和用户特定的约束，从而产生“构造即正确”的分子，并提供纯神经方法无法提供的可解释控制。NSGGM 在无约束生成和有约束生成任务上均表现出强劲性能，证明了神经符号建模在提供显式可控性和保证的同时，能够达到最先进的生成性能。为了评估更细致的可控性，我们还引入了一个逻辑约束分子基准（Logical-Constraint Molecular Benchmark），旨在测试在需要显式、可解释规范以及可验证合规性的工作流中，对严格硬规则的满足情况。

## Abstract
We challenge black-box purely deep neural approaches for molecules and graph generation, which are limited in controllability and lack formal guarantees. We introduce Neuro-Symbolic Graph Generative Modeling (NSGGM), a neurosymbolic framework that reapproaches molecule generation as a scaffold and interaction learning task with symbolic assembly. An autoregressive neural model proposes scaffolds and refines interaction signals, and a CPU-efficient SMT solver constructs full graphs while enforcing chemical validity, structural rules, and user-specific constraints, yielding molecules that are correct by construction and interpretable control that pure neural methods cannot provide. NSGGM delivers strong performance on both unconstrained generation and constrained generation tasks, demonstrating that neuro-symbolic modeling can match state-of-the-art generative performance while offering explicit controllability and guarantees. To evaluate more nuanced controllability, we also introduce a Logical-Constraint Molecular Benchmark, designed to test strict hard-rule satisfaction in workflows that require explicit, interpretable specifications together with verifiable compliance.

---

## 论文详细总结（自动生成）

这篇论文介绍了一种名为 **NSGGM（神经符号图生成建模）** 的新框架，旨在解决深度学习模型在分子和图生成中存在的“黑盒”属性及缺乏形式化保证的问题。以下是对该论文的结构化总结：

### 1. 核心问题与研究动机
*   **研究背景**：当前的分子生成主要依赖纯深度学习模型（如扩散模型、VAE、自回归模型）。虽然这些模型在捕捉数据分布方面表现出色，但它们通常将结构约束视为隐式学习的目标，无法为用户定义的硬约束（如特定的化学规则、复杂的逻辑组合）提供形式化的正确性保证。
*   **核心问题**：如何结合神经网络的强大生成能力与符号逻辑的严谨性，实现既符合数据分布又能在构建时即保证满足硬性约束（Correctness-by-construction）的图生成？

### 2. 方法论
NSGGM 采用了一种**“神经提议 + 符号保证”**的双阶段流水线：
*   **图分解与词汇表**：将分子分解为具有接口信息（插槽）的基元（Motifs/Fragments），包括环结构和树状组件。
*   **神经提议阶段（Neural Proposals）**：
    *   使用 GNN 编码器将分子映射到潜空间。
    *   利用自回归 Transformer 解码器生成基元序列。
    *   通过双向细化网络预测基元间的交互信号（如父节点索引、合并类型等），作为符号求解器的“软引导”。
*   **符号组装阶段（Symbolic Assembly）**：
    *   将图组装建模为**约束满足问题（CSP）**。
    *   使用 **SMT 求解器（Z3）** 执行硬约束（$\phi_{hard}$，如原子价键限制、元素一致性）和用户自定义约束（$\phi_{user}$，如复杂的逻辑谓词）。
    *   通过加权 Max-SMT 算法，在满足所有硬约束的前提下，最大化神经提议提供的软引导信号。

### 3. 实验设计
*   **数据集**：
    *   **分子生成**：QM9（小规模）、MOSES 和 GuacaMol（大规模）。
    *   **非分子图**：随机块模型（SBM）和平面图（Planar）。
*   **Benchmark 与对比方法**：
    *   对比了 MoLeR、DiGress（扩散模型）、JT-VAE、MiCaM 等最先进的方法。
    *   引入了全新的 **“逻辑约束分子基准”（Logical-Constraint Molecular Benchmark）**，测试模型在处理 XOR、IFF、AND 等复杂非局部逻辑约束时的表现。
*   **评估指标**：有效性（Validity）、唯一性（Uniqueness）、新颖性（Novelty）、FCD（分子相似度）、KL 散度以及约束满足效率。

### 4. 资源与算力
*   **硬件环境**：论文明确提到推理实验是在 **CPU 环境**下完成的（Google Colab, AMD EPYC 7B12, 8 vCPUs, 50GB RAM）。
*   **训练细节**：Transformer 解码器训练了 20 个 epoch，使用 Adam 优化器。
*   **算力说明**：文中未详细列出训练阶段消耗的总 GPU 时数，但强调了 SMT 求解器在 CPU 上运行的高效性，且推理吞吐量在 20-100 mol/s 之间。

### 5. 实验数量与充分性
*   **实验组数**：涵盖了从无约束生成到硬约束生成的多种场景，包括 3 个分子数据集和 2 个通用图数据集。
*   **消融实验**：进行了针对“神经引导”和“符号求解器”的消融研究，验证了双阶段框架的必要性。
*   **充分性评价**：实验设计较为全面，不仅对比了标准分布指标，还通过逻辑约束压力测试展示了模型在极端情况（训练集中无匹配样本）下的泛化能力。实验对比具有客观性，采用了标准的 Benchmark 划分。

### 6. 主要结论与发现
*   **100% 有效性**：由于 SMT 求解器的介入，NSGGM 在所有任务中均实现了 100% 的化学有效性。
*   **强大的逻辑处理能力**：在处理训练数据中从未出现过的复杂逻辑约束（如 $\phi_3$）时，纯神经模型几乎全部失败，而 NSGGM 仍能保持约 25% 的满足效率。
*   **性能平衡**：在无约束生成任务中，NSGGM 的分布保真度（FCD/KL）与当前最先进的纯神经模型持平，证明符号约束并未牺牲生成质量。

### 7. 优点与亮点
*   **形式化保证**：首次在分子生成中引入 SMT 求解器来提供可验证的硬约束保证。
*   **透明与可解释**：用户可以直接以逻辑公式形式定义约束，求解器返回的 SAT/UNSAT 结果具有高度可解释性。
*   **零样本约束满足**：无需针对特定约束重新训练模型，即可在推理时强制执行新规则。

### 8. 不足与局限
*   **逻辑定义的复杂性**：手动编写符号约束（SMT 公式）对普通用户有一定门槛，且逻辑描述可能过于僵硬，难以捕捉一些模糊的化学偏好。
*   **扩展性风险**：虽然在中小规模分子上表现良好，但对于节点数极多的超大规模图，SMT 求解的组合爆炸问题可能会限制推理速度。
*   **依赖基元分解**：模型的表现高度依赖于预定义的基元词汇表，对于完全新颖的拓扑结构可能存在覆盖不足的风险。

（完）

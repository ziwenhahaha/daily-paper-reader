name: Upstream Sync

permissions:
  contents: write # å¿…é¡»æœ‰å†™æƒé™æ‰èƒ½åˆå¹¶ä»£ç 

on:
  schedule:
    - cron: "0 0 * * *" # æ¯å¤© UTC 0ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´æ—©8ç‚¹ï¼‰æ£€æŸ¥æ›´æ–°
  workflow_dispatch: # å…è®¸ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»è§¦å‘

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }} # åªæœ‰ Fork çš„ä»“åº“æ‰è¿è¡Œ

    steps:
      # 1. æ£€å‡ºç”¨æˆ·ä»“åº“çš„ä»£ç 
      - name: Checkout target repo
        uses: actions/checkout@v3

      # 2. è¿è¡ŒåŒæ­¥ Action
      - name: Sync upstream changes
        id: sync
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
        with:
          # ğŸ‘‡ ã€é‡è¦ã€‘è¿™é‡Œå†™æ­»ä½ çš„æºä»“åº“åœ°å€ (Developer's Repo)
          upstream_sync_repo: ziwenhahaha/daily-paper-reader
          upstream_sync_branch: main
          target_sync_branch: main
          target_repo_token: ${{ secrets.GITHUB_TOKEN }} # è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€ç”¨æˆ·é…ç½®
          
          # ğŸ‘‡ ã€å…³é”®é…ç½®ã€‘è®¾ç½®ä¸º 'false' è¡¨ç¤ºè¿›è¡Œ Git Merge (åˆå¹¶)ï¼Œè€Œä¸æ˜¯è¦†ç›–
          # é»˜è®¤è¡Œä¸ºå…¶å®å°±æ˜¯ mergeï¼Œä½†ä¸ºäº†ä¿é™©èµ·è§ï¼Œä¸è¦å¼€å¯ 'hard_reset' ç±»çš„é€‰é¡¹
          test_mode: false

      # 3. å¦‚æœåŒæ­¥å¤±è´¥ï¼ˆæ¯”å¦‚æœ‰å†²çªï¼‰ï¼Œæ‰“å°é”™è¯¯
      - name: Sync check
        if: failure()
        run: |
          echo "[Error] è‡ªåŠ¨åŒæ­¥å¤±è´¥ï¼å¯èƒ½æ˜¯å› ä¸ºä½ ä¿®æ”¹äº†æºä»£ç å¯¼è‡´å†²çªã€‚"
          echo "è¯·æ‰‹åŠ¨å‰å¾€ GitHub é¡µé¢è§£å†³å†²çªã€‚"
          exit 1